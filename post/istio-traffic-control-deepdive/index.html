<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Source Themes Academia 4.3.1"><meta name=generator content="Hugo 0.73.0"><meta name=author content="Jing Lin (林静)"><meta name=description content="How istio manipulates the traffic."><link rel=alternate hreflang=en-us href=http://linjing.io/post/istio-traffic-control-deepdive/><meta name=theme-color content="#3f51b5"><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/academicons/1.8.6/css/academicons.min.css integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.6.0/css/all.css integrity=sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h crossorigin=anonymous><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/highlight.js/9.15.6/styles/github.min.css crossorigin=anonymous title=hl-light><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/highlight.js/9.15.6/styles/dracula.min.css crossorigin=anonymous title=hl-dark disabled><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lato:400,700|Open+Sans|Roboto+Mono&display=swap"><link rel=stylesheet href=/css/academia.min.bcef5eaccde0f18047d8dcec72cc428c.css><link rel=manifest href=/site.webmanifest><link rel=icon type=image/png href=/img/icon.png><link rel=apple-touch-icon type=image/png href=/img/icon-192.png><link rel=canonical href=http://linjing.io/post/istio-traffic-control-deepdive/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@linjingchina"><meta property="twitter:creator" content="@linjingchina"><meta property="og:site_name" content="Jing Lin‘s profile"><meta property="og:url" content="http://linjing.io/post/istio-traffic-control-deepdive/"><meta property="og:title" content="Istio sidecar iptables and traffic steering detail | Jing Lin‘s profile"><meta property="og:description" content="How istio manipulates the traffic."><meta property="og:image" content="http://linjing.io/post/istio-traffic-control-deepdive/featured.jpg"><meta property="twitter:image" content="http://linjing.io/post/istio-traffic-control-deepdive/featured.jpg"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2020-06-25T00:00:00+00:00"><meta property="article:modified_time" content="2020-07-12T22:34:33+08:00"><title>Istio sidecar iptables and traffic steering detail | Jing Lin‘s profile</title></head><body id=top data-spy=scroll data-target=#TableOfContents data-offset=71><aside class=search-results id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=#><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off role=textbox spellcheck=false type=search></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id=navbar-main><div class=container><a class=navbar-brand href=/>Jing Lin‘s profile</a>
<button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar aria-controls=navbar aria-expanded=false aria-label="Toggle navigation"><span><i class="fas fa-bars"></i></span></button><div class="collapse navbar-collapse" id=navbar><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/#about><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/#posts><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/#skills><span>Skills</span></a></li><li class=nav-item><a class=nav-link href=/#talks><span>Talks</span></a></li><li class=nav-item><a class=nav-link href=/#accomplishments><span>Accomplishments</span></a></li><li class=nav-item><a class=nav-link href=/#publications><span>Publications</span></a></li><li class=nav-item><a class=nav-link href=/#experience><span>Experience</span></a></li><li class=nav-item><a class="nav-link active" href=/><span>Courses</span></a></li><li class=nav-item><a class=nav-link href=/#slider><span>Customers</span></a></li><li class=nav-item><a class=nav-link href=/#contact><span>Contact</span></a></li><li class=nav-item><a class="nav-link js-search" href=#><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class="nav-link js-dark-toggle" href=#><i class="fas fa-moon" aria-hidden=true></i></a></li></ul></div></div></nav><article class="article py-5" itemscope itemtype=http://schema.org/Article><div class="container split-header"><div class="row justify-content-center"><div class=col-lg-8><img class="img-fluid w-100" src=/post/istio-traffic-control-deepdive/featured_huffb5f263acfab37ba3d9db7ea003493e_64408_680x500_fill_q90_lanczos_smart1.jpg itemprop=image alt>
<span class=article-header-caption>My tech blog <a href=https://imesh.club>https://imesh.club</a></span></div><div class=col-lg-8><h1 itemprop=name>Istio sidecar iptables and traffic steering detail</h1><p class=page-subtitle>Translate by google</p><meta content="2020-06-25 00:00:00 +0000 UTC" itemprop=datePublished><meta content="2020-07-12 22:34:33 +0800 +0800" itemprop=dateModified><div class=article-metadata><div><span itemprop="author name" itemtype=http://schema.org/Person><a href=/authors/admin/>Jing Lin (林静)</a></span></div><span class=article-date>Last updated on
<time>Jul 12, 2020</time></span>
<span class=middot-divider></span><span class=article-reading-time>7 min read</span>
<span class=middot-divider></span><a href=/post/istio-traffic-control-deepdive/#disqus_thread></a><div class=share-box aria-hidden=true><ul class=share><li><a href="https://twitter.com/intent/tweet?url=http://linjing.io/post/istio-traffic-control-deepdive/&text=Istio%20sidecar%20iptables%20and%20traffic%20steering%20detail" target=_blank rel=noopener class=share-btn-twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=http://linjing.io/post/istio-traffic-control-deepdive/&t=Istio%20sidecar%20iptables%20and%20traffic%20steering%20detail" target=_blank rel=noopener class=share-btn-facebook><i class="fab fa-facebook-f"></i></a></li><li><a href="mailto:?subject=Istio%20sidecar%20iptables%20and%20traffic%20steering%20detail&body=http://linjing.io/post/istio-traffic-control-deepdive/" target=_blank rel=noopener class=share-btn-email><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=http://linjing.io/post/istio-traffic-control-deepdive/&title=Istio%20sidecar%20iptables%20and%20traffic%20steering%20detail" target=_blank rel=noopener class=share-btn-linkedin><i class="fab fa-linkedin-in"></i></a></li><li><a href="https://web.whatsapp.com/send?text=Istio%20sidecar%20iptables%20and%20traffic%20steering%20detail%20http://linjing.io/post/istio-traffic-control-deepdive/" target=_blank rel=noopener class=share-btn-whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=http://linjing.io/post/istio-traffic-control-deepdive/&title=Istio%20sidecar%20iptables%20and%20traffic%20steering%20detail" target=_blank rel=noopener class=share-btn-weibo><i class="fab fa-weibo"></i></a></li></ul></div></div></div></div></div></div><div class=article-container><div class=article-style itemprop=articleBody><h2 id=istio-injected-iptables>Istio injected iptables</h2><p>Istio implements the hijacking and processing of traffic by injecting the init container and envoy proxy container into the business pod. After the init container runs, the following NAT table rules for iptables will be generated in the corresponding linux namespace</p><pre><code>&amp;#91;root@k8s-node1-v1-16 ~]# iptables -t nat -L -v
Chain PREROUTING (policy ACCEPT 192K packets, 12M bytes)
 pkts bytes target     prot opt in     out     source               destination
 192K   12M ISTIO_INBOUND  tcp  --  any    any     anywhere             anywhere

Chain INPUT (policy ACCEPT 192K packets, 12M bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain OUTPUT (policy ACCEPT 40673 packets, 3694K bytes)
 pkts bytes target     prot opt in     out     source               destination
 8917  535K ISTIO_OUTPUT  tcp  --  any    any     anywhere             anywhere

Chain POSTROUTING (policy ACCEPT 40673 packets, 3694K bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain ISTIO_INBOUND (1 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 RETURN     tcp  --  any    any     anywhere             anywhere             tcp dpt:ssh
  356 21360 RETURN     tcp  --  any    any     anywhere             anywhere             tcp dpt:15090
 192K   11M RETURN     tcp  --  any    any     anywhere             anywhere             tcp dpt:15021
    0     0 RETURN     tcp  --  any    any     anywhere             anywhere             tcp dpt:15020
   34  2040 ISTIO_IN_REDIRECT  tcp  --  any    any     anywhere             anywhere

Chain ISTIO_IN_REDIRECT (3 references)
 pkts bytes target     prot opt in     out     source               destination
   34  2040 REDIRECT   tcp  --  any    any     anywhere             anywhere             redir ports 15006

Chain ISTIO_OUTPUT (1 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 RETURN     all  --  any    lo      127.0.0.6            anywhere    
    0     0 ISTIO_IN_REDIRECT  all  --  any    lo      anywhere            !localhost            owner UID match 1337
    0     0 RETURN     all  --  any    lo      anywhere             anywhere             ! owner UID match 1337
 8917  535K RETURN     all  --  any    any     anywhere             anywhere             owner UID match 1337
    0     0 ISTIO_IN_REDIRECT  all  --  any    lo      anywhere            !localhost            owner GID match 1337
    0     0 RETURN     all  --  any    lo      anywhere             anywhere             ! owner GID match 1337
    0     0 RETURN     all  --  any    any     anywhere             anywhere             owner GID match 1337
    0     0 RETURN     all  --  any    any     anywhere             localhost
    0     0 ISTIO_REDIRECT  all  --  any    any     anywhere             anywhere

Chain ISTIO_REDIRECT (1 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 REDIRECT   tcp  --  any    any     anywhere             anywhere             redir ports 15001
</code></pre><h2 id=outbound-flow-control>Outbound flow control</h2><p>When the business container sends the request to the outside, such as productpage to reviews: 9080 port access, this connection will be redirected by iptables to port 127.0.0.1:115001, and then processed by envoy.</p><blockquote><p>REDIRECT
This target is only valid in the nat table, in the PREROUTING and OUTPUT chains, and user-defined chains which are only called from those chains. It redirects the packet to the machine itself by changing the destination IP to the primary address of the incoming interface (locally-generated packets are mapped to the localhost address, 127.0.0.1 for IPv4 and ::1 for IPv6).</p><p><a href=https://ipset.netfilter.org/iptables-extensions.man.html#lbDK>https://ipset.netfilter.org/iptables-extensions.man.html#lbDK</a></p></blockquote><p>The virtualOutbound in envoy will be hit. This is a special listener. It contains the Original Destination listener filter. Note &ldquo;useOriginalDst&rdquo;: truethat after such configuration in the following configuration , envoy will re-find the matching listener in the configuration. If found, press the hit. The listener performs follow-up processing. If it cannot find it, it sends the request to the cluster in this listener. Here is a passthrough cluster. This cluster will forward the packet directly to the fourth layer.</p><pre><code>root@k8s-master-v1-16 ~]# istioctl proxy-config listener productpage-v1-7f4cc988c6-qxqjs.istio-bookinfo --port 15001 -o json
&amp;#91;
    {
        &quot;name&quot;: &quot;virtualOutbound&quot;,
        &quot;address&quot;: {
            &quot;socketAddress&quot;: {
                &quot;address&quot;: &quot;0.0.0.0&quot;,
                &quot;portValue&quot;: 15001
            }
        },
        &quot;filterChains&quot;: &amp;#91;
            {
                &quot;filters&quot;: &amp;#91;
                    {
                        &quot;name&quot;: &quot;istio.stats&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm&quot;,
                            &quot;value&quot;: {
                                &quot;config&quot;: {
                                    &quot;configuration&quot;: &quot;{\n  \&quot;debug\&quot;: \&quot;false\&quot;,\n  \&quot;stat_prefix\&quot;: \&quot;istio\&quot;\n}\n&quot;,
                                    &quot;root_id&quot;: &quot;stats_outbound&quot;,
                                    &quot;vm_config&quot;: {
                                        &quot;code&quot;: {
                                            &quot;local&quot;: {
                                                &quot;inline_string&quot;: &quot;envoy.wasm.stats&quot;
                                            }
                                        },
                                        &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;,
                                        &quot;vm_id&quot;: &quot;tcp_stats_outbound&quot;
                                    }
                                }
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;envoy.tcp_proxy&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.network.tcp_proxy.v2.TcpProxy&quot;,
                            &quot;statPrefix&quot;: &quot;PassthroughCluster&quot;,
                            &quot;cluster&quot;: &quot;PassthroughCluster&quot;,
                            &quot;accessLog&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;envoy.file_access_log&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog&quot;,
                                        &quot;path&quot;: &quot;/dev/stdout&quot;,
                                        &quot;format&quot;: &quot;&amp;#91;%START_TIME%] \&quot;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\&quot; %RESPONSE_CODE% %RESPONSE_FLAGS% \&quot;%DYNAMIC_METADATA(istio.mixer:status)%\&quot; \&quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%\&quot; %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \&quot;%REQ(X-FORWARDED-FOR)%\&quot; \&quot;%REQ(USER-AGENT)%\&quot; \&quot;%REQ(X-REQUEST-ID)%\&quot; \&quot;%REQ(:AUTHORITY)%\&quot; \&quot;%UPSTREAM_HOST%\&quot; %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\n&quot;
                                    }
                                }
                            ]
                        }
                    }
                ],
                &quot;name&quot;: &quot;virtualOutbound-catchall-tcp&quot;
            }
        ],
        &quot;useOriginalDst&quot;: true,
        &quot;trafficDirection&quot;: &quot;OUTBOUND&quot;
    }
]
</code></pre><p>The above listener will hand over the connection to the listener that matches the original destination IP and port. In the bookinfo example, it will be handed over to the 9080 listener. There is a question to consider here. From the perspective of envoy, the destination port of this link is already 15001, why can it match the following port 0.0.0.0:9080. This is because the NAT is done in the system kernel when iptables is redirected. The system kernel has this converted storage. Envoy obtains the real destination port through getsockopt() , so that it can correctly match the business listener.</p><pre><code>&amp;#91;root@k8s-master-v1-16 ~]# istioctl proxy-config listener productpage-v1-7f4cc988c6-qxqjs.istio-bookinfo --port 9080 -o json
&amp;#91;
    {
        &quot;name&quot;: &quot;0.0.0.0_9080&quot;,
        &quot;address&quot;: {
            &quot;socketAddress&quot;: {
                &quot;address&quot;: &quot;0.0.0.0&quot;,
                &quot;portValue&quot;: 9080
            }
        },
        &quot;filterChains&quot;: &amp;#91;
            {
                &quot;filterChainMatch&quot;: {
                    &quot;applicationProtocols&quot;: &amp;#91;
                        &quot;http/1.0&quot;,
                        &quot;http/1.1&quot;,
                        &quot;h2c&quot;
                    ]
                },
                &quot;filters&quot;: &amp;#91;
                    {
                        &quot;name&quot;: &quot;envoy.http_connection_manager&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager&quot;,
                            &quot;statPrefix&quot;: &quot;outbound_0.0.0.0_9080&quot;,
                            &quot;rds&quot;: {
                                &quot;configSource&quot;: {
                                    &quot;ads&quot;: {}
                                },
                                &quot;routeConfigName&quot;: &quot;9080&quot;
                            },
</code></pre><pre><code>&amp;#91;root@k8s-master-v1-16 ~]# istioctl proxy-config listener productpage-v1-7f4cc988c6-qxqjs.istio-bookinfo
ADDRESS            PORT      TYPE
10.102.252.88      15012     TCP
10.96.122.225      31400     TCP
10.96.0.10         53        TCP
10.110.88.185      15443     TCP
10.96.122.225      15443     TCP
10.110.88.185      443       TCP
10.102.252.88      443       TCP
10.106.109.172     9001      TCP
10.96.0.1          443       TCP
10.96.122.225      443       TCP
10.106.109.172     9000      TCP
10.105.130.171     14267     HTTP+TCP
10.96.81.27        5601      HTTP+TCP
0.0.0.0            15014     HTTP+TCP
10.105.130.171     14250     HTTP+TCP
0.0.0.0            20001     HTTP+TCP
0.0.0.0            9411      HTTP+TCP
10.111.37.34       9090      HTTP+TCP
10.105.145.36      80        HTTP+TCP
10.105.130.171     14268     HTTP+TCP
10.96.0.10         9153      HTTP+TCP
10.110.244.188     80        HTTP+TCP
10.102.252.88      853       HTTP+TCP
10.99.139.251      16686     HTTP+TCP
0.0.0.0            12345     HTTP+TCP
10.103.155.149     80        HTTP+TCP
0.0.0.0            8000      HTTP+TCP
0.0.0.0            15010     HTTP+TCP
10.96.122.225      15020     HTTP+TCP
0.0.0.0            9090      HTTP+TCP
10.107.150.251     80        HTTP+TCP
0.0.0.0            14250     HTTP+TCP
0.0.0.0            80        HTTP+TCP
0.0.0.0            3000      HTTP+TCP
10.110.28.96       8181      HTTP+TCP
10.102.69.143      9200      HTTP+TCP
0.0.0.0            9080      HTTP+TCP 《《《《《《《《《《《《
0.0.0.0            15001     TCP 《《《《《《《《《《《《
0.0.0.0            15006     HTTP+TCP
0.0.0.0            15090     HTTP
0.0.0.0            15021     HTTP
</code></pre><p>Related passthrough cluster:</p><pre><code>root@k8s-master-v1-16 ~]# istioctl proxy-config cluster productpage-v1-7f4cc988c6-qxqjs.istio-bookinfo --fqdn PassthroughCluster -o json
&amp;#91;
。。。。忽略。。。
    {
        &quot;name&quot;: &quot;PassthroughCluster&quot;,
        &quot;type&quot;: &quot;ORIGINAL_DST&quot;,
        &quot;connectTimeout&quot;: &quot;10s&quot;,
        &quot;lbPolicy&quot;: &quot;CLUSTER_PROVIDED&quot;,
        &quot;circuitBreakers&quot;: {
            &quot;thresholds&quot;: &amp;#91;
                {
                    &quot;maxConnections&quot;: 4294967295,
                    &quot;maxPendingRequests&quot;: 4294967295,
                    &quot;maxRequests&quot;: 4294967295,
                    &quot;maxRetries&quot;: 4294967295
                }
            ]
        },
        &quot;filters&quot;: &amp;#91;
            {
                &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                &quot;typedConfig&quot;: {
                    &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                    &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange&quot;,
                    &quot;value&quot;: {
                        &quot;protocol&quot;: &quot;istio-peer-exchange&quot;
                    }
                }
            }
        ]
    }
]
</code></pre><h2 id=inbound-flow-control>Inbound flow control</h2><p>When it is an inbound request, the destination address of the packet is the IP of the pod, and the destination port is the real port of the business (9080, non-svc mapping port). Since the link destination port of iptables is changed to 15006, it will Hit virtual inbound listener (0.0.0.0:15006), this listener has a series of filterchain, and the virtualoutbound listener configuration method is different, virtualinbound contains a series of actual service filters for specific ports, the connection will find specific in these fitlers Business matching. So how does it match the real 9080 business? For example, the following output:
addressPrefix can be matched. If the pod actually has multiple ports, only addressPrefix does not match. It also needs to match the application layer protocol, but the DestinationPort in the Match condition is not matched . In fact, it is similar to Virtualoutbound. The filter of the original destination listener is also used, so envoy will obtain the real destination port and IP from the kernel. This configuration method is different from the virtual outbound &ldquo;useOriginalDst&rdquo;: true configuration method, because this is an updated configuration method.&rdquo; useOriginalDst&rdquo;: true This configuration is about to be abandoned.</p><p><code>"listenerFilters": [ { "name": "envoy.listener.original_dst", "typedConfig": { "@type": "type.googleapis.com/envoy.config.filter.listener.original_dst.v2.OriginalDst" } },</code></p><p>(According to <a href=https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/listener/listener_components.proto,>https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/listener/listener_components.proto,</a> the filtermatch condition is that all must match)</p><pre><code>            {
                &quot;filterChainMatch&quot;: {
                    &quot;destinationPort&quot;: 9080,
                    &quot;prefixRanges&quot;: &amp;#91;
                        {
                            &quot;addressPrefix&quot;: &quot;10.244.2.138&quot;,
                            &quot;prefixLen&quot;: 32
                        }
                    ],
### 根据https://istio.io/latest/zh/docs/ops/deployment/requirements/ , 
### 同一个业务端口是不能被两个用不同协议的svc来发布的，因此这帮助避免了同端口同协议的match在整个配置文件里的出现。
                    &quot;applicationProtocols&quot;: &amp;#91;
                        &quot;istio&quot;,
                        &quot;istio-http/1.0&quot;,
                        &quot;istio-http/1.1&quot;,
                        &quot;istio-h2&quot;
                    ]
                },
                &quot;filters&quot;: &amp;#91;
                    {
                        &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange&quot;,
                            &quot;value&quot;: {
                                &quot;protocol&quot;: &quot;istio-peer-exchange&quot;
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;envoy.http_connection_manager&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager&quot;,
                            &quot;statPrefix&quot;: &quot;inbound_10.244.2.138_9080&quot;,
                            &quot;routeConfig&quot;: {
                                &quot;name&quot;: &quot;inbound|9080|http|productpage.istio-bookinfo.svc.cluster.local&quot;,
                                &quot;virtualHosts&quot;: &amp;#91;
                                    {
                                        &quot;name&quot;: &quot;inbound|http|9080&quot;,
                                        &quot;domains&quot;: &amp;#91;
                                            &quot;*&quot;
                                        ],
                                        &quot;routes&quot;: &amp;#91;
                                            {
                                                &quot;name&quot;: &quot;default&quot;,
                                                &quot;match&quot;: {
                                                    &quot;prefix&quot;: &quot;/&quot;
                                                },
                                                &quot;route&quot;: {
                                                    &quot;cluster&quot;: &quot;inbound|9080|http|productpage.istio-bookinfo.svc.cluster.local&quot;,
                                                    &quot;timeout&quot;: &quot;0s&quot;,
                                                    &quot;maxGrpcTimeout&quot;: &quot;0s&quot;
                                                },
                                                &quot;decorator&quot;: {
                                                    &quot;operation&quot;: &quot;productpage.istio-bookinfo.svc.cluster.local:9080/*&quot;
                                                }
                                            }
                                        ]
                                    }
                                ],
</code></pre><h2 id=last>Last</h2><p>Attach the actual configuration of 15006</p><pre><code>&amp;#91;root@k8s-master-v1-16 ~]# istioctl proxy-config listener productpage-v1-7f4cc988c6-qxqjs.istio-bookinfo --port 15006 -o json
&amp;#91;
    {
        &quot;name&quot;: &quot;virtualInbound&quot;,
        &quot;address&quot;: {
            &quot;socketAddress&quot;: {
                &quot;address&quot;: &quot;0.0.0.0&quot;,
                &quot;portValue&quot;: 15006
            }
        },
        &quot;filterChains&quot;: &amp;#91;
            {
                &quot;filterChainMatch&quot;: {
                    &quot;prefixRanges&quot;: &amp;#91;
                        {
                            &quot;addressPrefix&quot;: &quot;0.0.0.0&quot;,
                            &quot;prefixLen&quot;: 0
                        }
                    ],
                    &quot;transportProtocol&quot;: &quot;tls&quot;,
                    &quot;applicationProtocols&quot;: &amp;#91;
                        &quot;istio-peer-exchange&quot;,
                        &quot;istio&quot;
                    ]
                },
                &quot;filters&quot;: &amp;#91;
                    {
                        &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange&quot;,
                            &quot;value&quot;: {
                                &quot;protocol&quot;: &quot;istio-peer-exchange&quot;
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;istio.stats&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm&quot;,
                            &quot;value&quot;: {
                                &quot;config&quot;: {
                                    &quot;configuration&quot;: &quot;{\n  \&quot;debug\&quot;: \&quot;false\&quot;,\n  \&quot;stat_prefix\&quot;: \&quot;istio\&quot;\n}\n&quot;,
                                    &quot;root_id&quot;: &quot;stats_inbound&quot;,
                                    &quot;vm_config&quot;: {
                                        &quot;code&quot;: {
                                            &quot;local&quot;: {
                                                &quot;inline_string&quot;: &quot;envoy.wasm.stats&quot;
                                            }
                                        },
                                        &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;,
                                        &quot;vm_id&quot;: &quot;tcp_stats_inbound&quot;
                                    }
                                }
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;envoy.tcp_proxy&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.network.tcp_proxy.v2.TcpProxy&quot;,
                            &quot;statPrefix&quot;: &quot;InboundPassthroughClusterIpv4&quot;,
                            &quot;cluster&quot;: &quot;InboundPassthroughClusterIpv4&quot;,
                            &quot;accessLog&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;envoy.file_access_log&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog&quot;,
                                        &quot;path&quot;: &quot;/dev/stdout&quot;,
                                        &quot;format&quot;: &quot;&amp;#91;%START_TIME%] \&quot;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\&quot; %RESPONSE_CODE% %RESPONSE_FLAGS% \&quot;%DYNAMIC_METADATA(istio.mixer:status)%\&quot; \&quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%\&quot; %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \&quot;%REQ(X-FORWARDED-FOR)%\&quot; \&quot;%REQ(USER-AGENT)%\&quot; \&quot;%REQ(X-REQUEST-ID)%\&quot; \&quot;%REQ(:AUTHORITY)%\&quot; \&quot;%UPSTREAM_HOST%\&quot; %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\n&quot;
                                    }
                                }
                            ]
                        }
                    }
                ],
                &quot;transportSocket&quot;: {
                    &quot;name&quot;: &quot;envoy.transport_sockets.tls&quot;,
                    &quot;typedConfig&quot;: {
                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.api.v2.auth.DownstreamTlsContext&quot;,
                        &quot;commonTlsContext&quot;: {
                            &quot;tlsCertificateSdsSecretConfigs&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;default&quot;,
                                    &quot;sdsConfig&quot;: {
                                        &quot;apiConfigSource&quot;: {
                                            &quot;apiType&quot;: &quot;GRPC&quot;,
                                            &quot;grpcServices&quot;: &amp;#91;
                                                {
                                                    &quot;envoyGrpc&quot;: {
                                                        &quot;clusterName&quot;: &quot;sds-grpc&quot;
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            ],
                            &quot;combinedValidationContext&quot;: {
                                &quot;defaultValidationContext&quot;: {},
                                &quot;validationContextSdsSecretConfig&quot;: {
                                    &quot;name&quot;: &quot;ROOTCA&quot;,
                                    &quot;sdsConfig&quot;: {
                                        &quot;apiConfigSource&quot;: {
                                            &quot;apiType&quot;: &quot;GRPC&quot;,
                                            &quot;grpcServices&quot;: &amp;#91;
                                                {
                                                    &quot;envoyGrpc&quot;: {
                                                        &quot;clusterName&quot;: &quot;sds-grpc&quot;
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            },
                            &quot;alpnProtocols&quot;: &amp;#91;
                                &quot;istio-peer-exchange&quot;,
                                &quot;h2&quot;,
                                &quot;http/1.1&quot;
                            ]
                        },
                        &quot;requireClientCertificate&quot;: true
                    }
                },
                &quot;name&quot;: &quot;virtualInbound&quot;
            },
            {
                &quot;filterChainMatch&quot;: {
                    &quot;prefixRanges&quot;: &amp;#91;
                        {
                            &quot;addressPrefix&quot;: &quot;0.0.0.0&quot;,
                            &quot;prefixLen&quot;: 0
                        }
                    ]
                },
                &quot;filters&quot;: &amp;#91;
                    {
                        &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange&quot;,
                            &quot;value&quot;: {
                                &quot;protocol&quot;: &quot;istio-peer-exchange&quot;
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;istio.stats&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm&quot;,
                            &quot;value&quot;: {
                                &quot;config&quot;: {
                                    &quot;configuration&quot;: &quot;{\n  \&quot;debug\&quot;: \&quot;false\&quot;,\n  \&quot;stat_prefix\&quot;: \&quot;istio\&quot;\n}\n&quot;,
                                    &quot;root_id&quot;: &quot;stats_inbound&quot;,
                                    &quot;vm_config&quot;: {
                                        &quot;code&quot;: {
                                            &quot;local&quot;: {
                                                &quot;inline_string&quot;: &quot;envoy.wasm.stats&quot;
                                            }
                                        },
                                        &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;,
                                        &quot;vm_id&quot;: &quot;tcp_stats_inbound&quot;
                                    }
                                }
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;envoy.tcp_proxy&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.network.tcp_proxy.v2.TcpProxy&quot;,
                            &quot;statPrefix&quot;: &quot;InboundPassthroughClusterIpv4&quot;,
                            &quot;cluster&quot;: &quot;InboundPassthroughClusterIpv4&quot;,
                            &quot;accessLog&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;envoy.file_access_log&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog&quot;,
                                        &quot;path&quot;: &quot;/dev/stdout&quot;,
                                        &quot;format&quot;: &quot;&amp;#91;%START_TIME%] \&quot;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\&quot; %RESPONSE_CODE% %RESPONSE_FLAGS% \&quot;%DYNAMIC_METADATA(istio.mixer:status)%\&quot; \&quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%\&quot; %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \&quot;%REQ(X-FORWARDED-FOR)%\&quot; \&quot;%REQ(USER-AGENT)%\&quot; \&quot;%REQ(X-REQUEST-ID)%\&quot; \&quot;%REQ(:AUTHORITY)%\&quot; \&quot;%UPSTREAM_HOST%\&quot; %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\n&quot;
                                    }
                                }
                            ]
                        }
                    }
                ],
                &quot;name&quot;: &quot;virtualInbound&quot;
            },
            {
                &quot;filterChainMatch&quot;: {
                    &quot;prefixRanges&quot;: &amp;#91;
                        {
                            &quot;addressPrefix&quot;: &quot;0.0.0.0&quot;,
                            &quot;prefixLen&quot;: 0
                        }
                    ],
                    &quot;transportProtocol&quot;: &quot;tls&quot;,
                    &quot;applicationProtocols&quot;: &amp;#91;
                        &quot;http/1.0&quot;,
                        &quot;http/1.1&quot;,
                        &quot;h2c&quot;,
                        &quot;istio-http/1.0&quot;,
                        &quot;istio-http/1.1&quot;,
                        &quot;istio-h2&quot;
                    ]
                },
                &quot;filters&quot;: &amp;#91;
                    {
                        &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange&quot;,
                            &quot;value&quot;: {
                                &quot;protocol&quot;: &quot;istio-peer-exchange&quot;
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;envoy.http_connection_manager&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager&quot;,
                            &quot;statPrefix&quot;: &quot;InboundPassthroughClusterIpv4&quot;,
                            &quot;routeConfig&quot;: {
                                &quot;name&quot;: &quot;InboundPassthroughClusterIpv4&quot;,
                                &quot;virtualHosts&quot;: &amp;#91;
                                    {
                                        &quot;name&quot;: &quot;inbound|http|0&quot;,
                                        &quot;domains&quot;: &amp;#91;
                                            &quot;*&quot;
                                        ],
                                        &quot;routes&quot;: &amp;#91;
                                            {
                                                &quot;name&quot;: &quot;default&quot;,
                                                &quot;match&quot;: {
                                                    &quot;prefix&quot;: &quot;/&quot;
                                                },
                                                &quot;route&quot;: {
                                                    &quot;cluster&quot;: &quot;InboundPassthroughClusterIpv4&quot;,
                                                    &quot;timeout&quot;: &quot;0s&quot;,
                                                    &quot;maxGrpcTimeout&quot;: &quot;0s&quot;
                                                },
                                                &quot;decorator&quot;: {
                                                    &quot;operation&quot;: &quot;:0/*&quot;
                                                }
                                            }
                                        ]
                                    }
                                ],
                                &quot;validateClusters&quot;: false
                            },
                            &quot;httpFilters&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                                        &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&quot;,
                                        &quot;value&quot;: {
                                            &quot;config&quot;: {
                                                &quot;configuration&quot;: &quot;{}\n&quot;,
                                                &quot;vm_config&quot;: {
                                                    &quot;code&quot;: {
                                                        &quot;local&quot;: {
                                                            &quot;inline_string&quot;: &quot;envoy.wasm.metadata_exchange&quot;
                                                        }
                                                    },
                                                    &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;
                                                }
                                            }
                                        }
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.cors&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.cors.v2.Cors&quot;
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.fault&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.fault.v2.HTTPFault&quot;
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;istio.stats&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                                        &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&quot;,
                                        &quot;value&quot;: {
                                            &quot;config&quot;: {
                                                &quot;configuration&quot;: &quot;{\n  \&quot;debug\&quot;: \&quot;false\&quot;,\n  \&quot;stat_prefix\&quot;: \&quot;istio\&quot;\n}\n&quot;,
                                                &quot;root_id&quot;: &quot;stats_inbound&quot;,
                                                &quot;vm_config&quot;: {
                                                    &quot;code&quot;: {
                                                        &quot;local&quot;: {
                                                            &quot;inline_string&quot;: &quot;envoy.wasm.stats&quot;
                                                        }
                                                    },
                                                    &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;,
                                                    &quot;vm_id&quot;: &quot;stats_inbound&quot;
                                                }
                                            }
                                        }
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.router&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.router.v2.Router&quot;
                                    }
                                }
                            ],
                            &quot;tracing&quot;: {
                                &quot;clientSampling&quot;: {
                                    &quot;value&quot;: 100
                                },
                                &quot;randomSampling&quot;: {
                                    &quot;value&quot;: 100
                                },
                                &quot;overallSampling&quot;: {
                                    &quot;value&quot;: 100
                                }
                            },
                            &quot;serverName&quot;: &quot;istio-envoy&quot;,
                            &quot;streamIdleTimeout&quot;: &quot;0s&quot;,
                            &quot;accessLog&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;envoy.file_access_log&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog&quot;,
                                        &quot;path&quot;: &quot;/dev/stdout&quot;,
                                        &quot;format&quot;: &quot;&amp;#91;%START_TIME%] \&quot;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\&quot; %RESPONSE_CODE% %RESPONSE_FLAGS% \&quot;%DYNAMIC_METADATA(istio.mixer:status)%\&quot; \&quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%\&quot; %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \&quot;%REQ(X-FORWARDED-FOR)%\&quot; \&quot;%REQ(USER-AGENT)%\&quot; \&quot;%REQ(X-REQUEST-ID)%\&quot; \&quot;%REQ(:AUTHORITY)%\&quot; \&quot;%UPSTREAM_HOST%\&quot; %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\n&quot;
                                    }
                                }
                            ],
                            &quot;useRemoteAddress&quot;: false,
                            &quot;generateRequestId&quot;: true,
                            &quot;forwardClientCertDetails&quot;: &quot;APPEND_FORWARD&quot;,
                            &quot;setCurrentClientCertDetails&quot;: {
                                &quot;subject&quot;: true,
                                &quot;dns&quot;: true,
                                &quot;uri&quot;: true
                            },
                            &quot;upgradeConfigs&quot;: &amp;#91;
                                {
                                    &quot;upgradeType&quot;: &quot;websocket&quot;
                                }
                            ],
                            &quot;normalizePath&quot;: true
                        }
                    }
                ],
                &quot;transportSocket&quot;: {
                    &quot;name&quot;: &quot;envoy.transport_sockets.tls&quot;,
                    &quot;typedConfig&quot;: {
                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.api.v2.auth.DownstreamTlsContext&quot;,
                        &quot;commonTlsContext&quot;: {
                            &quot;tlsCertificateSdsSecretConfigs&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;default&quot;,
                                    &quot;sdsConfig&quot;: {
                                        &quot;apiConfigSource&quot;: {
                                            &quot;apiType&quot;: &quot;GRPC&quot;,
                                            &quot;grpcServices&quot;: &amp;#91;
                                                {
                                                    &quot;envoyGrpc&quot;: {
                                                        &quot;clusterName&quot;: &quot;sds-grpc&quot;
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            ],
                            &quot;combinedValidationContext&quot;: {
                                &quot;defaultValidationContext&quot;: {},
                                &quot;validationContextSdsSecretConfig&quot;: {
                                    &quot;name&quot;: &quot;ROOTCA&quot;,
                                    &quot;sdsConfig&quot;: {
                                        &quot;apiConfigSource&quot;: {
                                            &quot;apiType&quot;: &quot;GRPC&quot;,
                                            &quot;grpcServices&quot;: &amp;#91;
                                                {
                                                    &quot;envoyGrpc&quot;: {
                                                        &quot;clusterName&quot;: &quot;sds-grpc&quot;
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            },
                            &quot;alpnProtocols&quot;: &amp;#91;
                                &quot;h2&quot;,
                                &quot;http/1.1&quot;
                            ]
                        },
                        &quot;requireClientCertificate&quot;: true
                    }
                },
                &quot;name&quot;: &quot;virtualInbound-catchall-http&quot;
            },
            {
                &quot;filterChainMatch&quot;: {
                    &quot;prefixRanges&quot;: &amp;#91;
                        {
                            &quot;addressPrefix&quot;: &quot;0.0.0.0&quot;,
                            &quot;prefixLen&quot;: 0
                        }
                    ],
                    &quot;applicationProtocols&quot;: &amp;#91;
                        &quot;http/1.0&quot;,
                        &quot;http/1.1&quot;,
                        &quot;h2c&quot;
                    ]
                },
                &quot;filters&quot;: &amp;#91;
                    {
                        &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange&quot;,
                            &quot;value&quot;: {
                                &quot;protocol&quot;: &quot;istio-peer-exchange&quot;
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;envoy.http_connection_manager&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager&quot;,
                            &quot;statPrefix&quot;: &quot;InboundPassthroughClusterIpv4&quot;,
                            &quot;routeConfig&quot;: {
                                &quot;name&quot;: &quot;InboundPassthroughClusterIpv4&quot;,
                                &quot;virtualHosts&quot;: &amp;#91;
                                    {
                                        &quot;name&quot;: &quot;inbound|http|0&quot;,
                                        &quot;domains&quot;: &amp;#91;
                                            &quot;*&quot;
                                        ],
                                        &quot;routes&quot;: &amp;#91;
                                            {
                                                &quot;name&quot;: &quot;default&quot;,
                                                &quot;match&quot;: {
                                                    &quot;prefix&quot;: &quot;/&quot;
                                                },
                                                &quot;route&quot;: {
                                                    &quot;cluster&quot;: &quot;InboundPassthroughClusterIpv4&quot;,
                                                    &quot;timeout&quot;: &quot;0s&quot;,
                                                    &quot;maxGrpcTimeout&quot;: &quot;0s&quot;
                                                },
                                                &quot;decorator&quot;: {
                                                    &quot;operation&quot;: &quot;:0/*&quot;
                                                }
                                            }
                                        ]
                                    }
                                ],
                                &quot;validateClusters&quot;: false
                            },
                            &quot;httpFilters&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                                        &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&quot;,
                                        &quot;value&quot;: {
                                            &quot;config&quot;: {
                                                &quot;configuration&quot;: &quot;{}\n&quot;,
                                                &quot;vm_config&quot;: {
                                                    &quot;code&quot;: {
                                                        &quot;local&quot;: {
                                                            &quot;inline_string&quot;: &quot;envoy.wasm.metadata_exchange&quot;
                                                        }
                                                    },
                                                    &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;
                                                }
                                            }
                                        }
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.cors&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.cors.v2.Cors&quot;
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.fault&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.fault.v2.HTTPFault&quot;
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;istio.stats&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                                        &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&quot;,
                                        &quot;value&quot;: {
                                            &quot;config&quot;: {
                                                &quot;configuration&quot;: &quot;{\n  \&quot;debug\&quot;: \&quot;false\&quot;,\n  \&quot;stat_prefix\&quot;: \&quot;istio\&quot;\n}\n&quot;,
                                                &quot;root_id&quot;: &quot;stats_inbound&quot;,
                                                &quot;vm_config&quot;: {
                                                    &quot;code&quot;: {
                                                        &quot;local&quot;: {
                                                            &quot;inline_string&quot;: &quot;envoy.wasm.stats&quot;
                                                        }
                                                    },
                                                    &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;,
                                                    &quot;vm_id&quot;: &quot;stats_inbound&quot;
                                                }
                                            }
                                        }
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.router&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.router.v2.Router&quot;
                                    }
                                }
                            ],
                            &quot;tracing&quot;: {
                                &quot;clientSampling&quot;: {
                                    &quot;value&quot;: 100
                                },
                                &quot;randomSampling&quot;: {
                                    &quot;value&quot;: 100
                                },
                                &quot;overallSampling&quot;: {
                                    &quot;value&quot;: 100
                                }
                            },
                            &quot;serverName&quot;: &quot;istio-envoy&quot;,
                            &quot;streamIdleTimeout&quot;: &quot;0s&quot;,
                            &quot;accessLog&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;envoy.file_access_log&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog&quot;,
                                        &quot;path&quot;: &quot;/dev/stdout&quot;,
                                        &quot;format&quot;: &quot;&amp;#91;%START_TIME%] \&quot;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\&quot; %RESPONSE_CODE% %RESPONSE_FLAGS% \&quot;%DYNAMIC_METADATA(istio.mixer:status)%\&quot; \&quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%\&quot; %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \&quot;%REQ(X-FORWARDED-FOR)%\&quot; \&quot;%REQ(USER-AGENT)%\&quot; \&quot;%REQ(X-REQUEST-ID)%\&quot; \&quot;%REQ(:AUTHORITY)%\&quot; \&quot;%UPSTREAM_HOST%\&quot; %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\n&quot;
                                    }
                                }
                            ],
                            &quot;useRemoteAddress&quot;: false,
                            &quot;generateRequestId&quot;: true,
                            &quot;forwardClientCertDetails&quot;: &quot;APPEND_FORWARD&quot;,
                            &quot;setCurrentClientCertDetails&quot;: {
                                &quot;subject&quot;: true,
                                &quot;dns&quot;: true,
                                &quot;uri&quot;: true
                            },
                            &quot;upgradeConfigs&quot;: &amp;#91;
                                {
                                    &quot;upgradeType&quot;: &quot;websocket&quot;
                                }
                            ],
                            &quot;normalizePath&quot;: true
                        }
                    }
                ],
                &quot;name&quot;: &quot;virtualInbound-catchall-http&quot;
            },
            {
                &quot;filterChainMatch&quot;: {
                    &quot;destinationPort&quot;: 15021,
                    &quot;prefixRanges&quot;: &amp;#91;
                        {
                            &quot;addressPrefix&quot;: &quot;10.244.2.155&quot;,
                            &quot;prefixLen&quot;: 32
                        }
                    ]
                },
                &quot;filters&quot;: &amp;#91;
                    {
                        &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange&quot;,
                            &quot;value&quot;: {
                                &quot;protocol&quot;: &quot;istio-peer-exchange&quot;
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;istio.stats&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm&quot;,
                            &quot;value&quot;: {
                                &quot;config&quot;: {
                                    &quot;configuration&quot;: &quot;{\n  \&quot;debug\&quot;: \&quot;false\&quot;,\n  \&quot;stat_prefix\&quot;: \&quot;istio\&quot;\n}\n&quot;,
                                    &quot;root_id&quot;: &quot;stats_inbound&quot;,
                                    &quot;vm_config&quot;: {
                                        &quot;code&quot;: {
                                            &quot;local&quot;: {
                                                &quot;inline_string&quot;: &quot;envoy.wasm.stats&quot;
                                            }
                                        },
                                        &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;,
                                        &quot;vm_id&quot;: &quot;tcp_stats_inbound&quot;
                                    }
                                }
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;envoy.tcp_proxy&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.network.tcp_proxy.v2.TcpProxy&quot;,
                            &quot;statPrefix&quot;: &quot;inbound|15021|mgmt-15021|mgmtCluster&quot;,
                            &quot;cluster&quot;: &quot;inbound|15021|mgmt-15021|mgmtCluster&quot;,
                            &quot;accessLog&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;envoy.file_access_log&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog&quot;,
                                        &quot;path&quot;: &quot;/dev/stdout&quot;,
                                        &quot;format&quot;: &quot;&amp;#91;%START_TIME%] \&quot;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\&quot; %RESPONSE_CODE% %RESPONSE_FLAGS% \&quot;%DYNAMIC_METADATA(istio.mixer:status)%\&quot; \&quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%\&quot; %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \&quot;%REQ(X-FORWARDED-FOR)%\&quot; \&quot;%REQ(USER-AGENT)%\&quot; \&quot;%REQ(X-REQUEST-ID)%\&quot; \&quot;%REQ(:AUTHORITY)%\&quot; \&quot;%UPSTREAM_HOST%\&quot; %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\n&quot;
                                    }
                                }
                            ]
                        }
                    }
                ],
                &quot;name&quot;: &quot;10.244.2.155_15021&quot;
            },
            {
                &quot;filterChainMatch&quot;: {
                    &quot;destinationPort&quot;: 9080,
                    &quot;prefixRanges&quot;: &amp;#91;
                        {
                            &quot;addressPrefix&quot;: &quot;10.244.2.155&quot;,
                            &quot;prefixLen&quot;: 32
                        }
                    ],
                    &quot;applicationProtocols&quot;: &amp;#91;
                        &quot;istio&quot;,
                        &quot;istio-http/1.0&quot;,
                        &quot;istio-http/1.1&quot;,
                        &quot;istio-h2&quot;
                    ]
                },
                &quot;filters&quot;: &amp;#91;
                    {
                        &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange&quot;,
                            &quot;value&quot;: {
                                &quot;protocol&quot;: &quot;istio-peer-exchange&quot;
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;envoy.http_connection_manager&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager&quot;,
                            &quot;statPrefix&quot;: &quot;inbound_10.244.2.155_9080&quot;,
                            &quot;routeConfig&quot;: {
                                &quot;name&quot;: &quot;inbound|9080|http|productpage.istio-bookinfo.svc.cluster.local&quot;,
                                &quot;virtualHosts&quot;: &amp;#91;
                                    {
                                        &quot;name&quot;: &quot;inbound|http|9080&quot;,
                                        &quot;domains&quot;: &amp;#91;
                                            &quot;*&quot;
                                        ],
                                        &quot;routes&quot;: &amp;#91;
                                            {
                                                &quot;name&quot;: &quot;default&quot;,
                                                &quot;match&quot;: {
                                                    &quot;prefix&quot;: &quot;/&quot;
                                                },
                                                &quot;route&quot;: {
                                                    &quot;cluster&quot;: &quot;inbound|9080|http|productpage.istio-bookinfo.svc.cluster.local&quot;,
                                                    &quot;timeout&quot;: &quot;0s&quot;,
                                                    &quot;maxGrpcTimeout&quot;: &quot;0s&quot;
                                                },
                                                &quot;decorator&quot;: {
                                                    &quot;operation&quot;: &quot;productpage.istio-bookinfo.svc.cluster.local:9080/*&quot;
                                                }
                                            }
                                        ]
                                    }
                                ],
                                &quot;validateClusters&quot;: false
                            },
                            &quot;httpFilters&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                                        &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&quot;,
                                        &quot;value&quot;: {
                                            &quot;config&quot;: {
                                                &quot;configuration&quot;: &quot;{}\n&quot;,
                                                &quot;vm_config&quot;: {
                                                    &quot;code&quot;: {
                                                        &quot;local&quot;: {
                                                            &quot;inline_string&quot;: &quot;envoy.wasm.metadata_exchange&quot;
                                                        }
                                                    },
                                                    &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;
                                                }
                                            }
                                        }
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;istio_authn&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/istio.envoy.config.filter.http.authn.v2alpha1.FilterConfig&quot;,
                                        &quot;policy&quot;: {
                                            &quot;peers&quot;: &amp;#91;
                                                {
                                                    &quot;mtls&quot;: {
                                                        &quot;mode&quot;: &quot;PERMISSIVE&quot;
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.cors&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.cors.v2.Cors&quot;
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.fault&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.fault.v2.HTTPFault&quot;
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;istio.stats&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                                        &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&quot;,
                                        &quot;value&quot;: {
                                            &quot;config&quot;: {
                                                &quot;configuration&quot;: &quot;{\n  \&quot;debug\&quot;: \&quot;false\&quot;,\n  \&quot;stat_prefix\&quot;: \&quot;istio\&quot;\n}\n&quot;,
                                                &quot;root_id&quot;: &quot;stats_inbound&quot;,
                                                &quot;vm_config&quot;: {
                                                    &quot;code&quot;: {
                                                        &quot;local&quot;: {
                                                            &quot;inline_string&quot;: &quot;envoy.wasm.stats&quot;
                                                        }
                                                    },
                                                    &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;,
                                                    &quot;vm_id&quot;: &quot;stats_inbound&quot;
                                                }
                                            }
                                        }
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.router&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.router.v2.Router&quot;
                                    }
                                }
                            ],
                            &quot;tracing&quot;: {
                                &quot;clientSampling&quot;: {
                                    &quot;value&quot;: 100
                                },
                                &quot;randomSampling&quot;: {
                                    &quot;value&quot;: 100
                                },
                                &quot;overallSampling&quot;: {
                                    &quot;value&quot;: 100
                                }
                            },
                            &quot;serverName&quot;: &quot;istio-envoy&quot;,
                            &quot;streamIdleTimeout&quot;: &quot;0s&quot;,
                            &quot;accessLog&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;envoy.file_access_log&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog&quot;,
                                        &quot;path&quot;: &quot;/dev/stdout&quot;,
                                        &quot;format&quot;: &quot;&amp;#91;%START_TIME%] \&quot;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\&quot; %RESPONSE_CODE% %RESPONSE_FLAGS% \&quot;%DYNAMIC_METADATA(istio.mixer:status)%\&quot; \&quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%\&quot; %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \&quot;%REQ(X-FORWARDED-FOR)%\&quot; \&quot;%REQ(USER-AGENT)%\&quot; \&quot;%REQ(X-REQUEST-ID)%\&quot; \&quot;%REQ(:AUTHORITY)%\&quot; \&quot;%UPSTREAM_HOST%\&quot; %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\n&quot;
                                    }
                                }
                            ],
                            &quot;useRemoteAddress&quot;: false,
                            &quot;generateRequestId&quot;: true,
                            &quot;forwardClientCertDetails&quot;: &quot;APPEND_FORWARD&quot;,
                            &quot;setCurrentClientCertDetails&quot;: {
                                &quot;subject&quot;: true,
                                &quot;dns&quot;: true,
                                &quot;uri&quot;: true
                            },
                            &quot;upgradeConfigs&quot;: &amp;#91;
                                {
                                    &quot;upgradeType&quot;: &quot;websocket&quot;
                                }
                            ],
                            &quot;normalizePath&quot;: true
                        }
                    }
                ],
                &quot;transportSocket&quot;: {
                    &quot;name&quot;: &quot;envoy.transport_sockets.tls&quot;,
                    &quot;typedConfig&quot;: {
                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.api.v2.auth.DownstreamTlsContext&quot;,
                        &quot;commonTlsContext&quot;: {
                            &quot;tlsCertificateSdsSecretConfigs&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;default&quot;,
                                    &quot;sdsConfig&quot;: {
                                        &quot;apiConfigSource&quot;: {
                                            &quot;apiType&quot;: &quot;GRPC&quot;,
                                            &quot;grpcServices&quot;: &amp;#91;
                                                {
                                                    &quot;envoyGrpc&quot;: {
                                                        &quot;clusterName&quot;: &quot;sds-grpc&quot;
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            ],
                            &quot;combinedValidationContext&quot;: {
                                &quot;defaultValidationContext&quot;: {},
                                &quot;validationContextSdsSecretConfig&quot;: {
                                    &quot;name&quot;: &quot;ROOTCA&quot;,
                                    &quot;sdsConfig&quot;: {
                                        &quot;apiConfigSource&quot;: {
                                            &quot;apiType&quot;: &quot;GRPC&quot;,
                                            &quot;grpcServices&quot;: &amp;#91;
                                                {
                                                    &quot;envoyGrpc&quot;: {
                                                        &quot;clusterName&quot;: &quot;sds-grpc&quot;
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            },
                            &quot;alpnProtocols&quot;: &amp;#91;
                                &quot;h2&quot;,
                                &quot;http/1.1&quot;
                            ]
                        },
                        &quot;requireClientCertificate&quot;: true
                    }
                },
                &quot;name&quot;: &quot;10.244.2.155_9080&quot;
            },
            {
                &quot;filterChainMatch&quot;: {
                    &quot;destinationPort&quot;: 9080,
                    &quot;prefixRanges&quot;: &amp;#91;
                        {
                            &quot;addressPrefix&quot;: &quot;10.244.2.155&quot;,
                            &quot;prefixLen&quot;: 32
                        }
                    ]
                },
                &quot;filters&quot;: &amp;#91;
                    {
                        &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange&quot;,
                            &quot;value&quot;: {
                                &quot;protocol&quot;: &quot;istio-peer-exchange&quot;
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;envoy.http_connection_manager&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager&quot;,
                            &quot;statPrefix&quot;: &quot;inbound_10.244.2.155_9080&quot;,
                            &quot;routeConfig&quot;: {
                                &quot;name&quot;: &quot;inbound|9080|http|productpage.istio-bookinfo.svc.cluster.local&quot;,
                                &quot;virtualHosts&quot;: &amp;#91;
                                    {
                                        &quot;name&quot;: &quot;inbound|http|9080&quot;,
                                        &quot;domains&quot;: &amp;#91;
                                            &quot;*&quot;
                                        ],
                                        &quot;routes&quot;: &amp;#91;
                                            {
                                                &quot;name&quot;: &quot;default&quot;,
                                                &quot;match&quot;: {
                                                    &quot;prefix&quot;: &quot;/&quot;
                                                },
                                                &quot;route&quot;: {
                                                    &quot;cluster&quot;: &quot;inbound|9080|http|productpage.istio-bookinfo.svc.cluster.local&quot;,
                                                    &quot;timeout&quot;: &quot;0s&quot;,
                                                    &quot;maxGrpcTimeout&quot;: &quot;0s&quot;
                                                },
                                                &quot;decorator&quot;: {
                                                    &quot;operation&quot;: &quot;productpage.istio-bookinfo.svc.cluster.local:9080/*&quot;
                                                }
                                            }
                                        ]
                                    }
                                ],
                                &quot;validateClusters&quot;: false
                            },
                            &quot;httpFilters&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                                        &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&quot;,
                                        &quot;value&quot;: {
                                            &quot;config&quot;: {
                                                &quot;configuration&quot;: &quot;{}\n&quot;,
                                                &quot;vm_config&quot;: {
                                                    &quot;code&quot;: {
                                                        &quot;local&quot;: {
                                                            &quot;inline_string&quot;: &quot;envoy.wasm.metadata_exchange&quot;
                                                        }
                                                    },
                                                    &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;
                                                }
                                            }
                                        }
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;istio_authn&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/istio.envoy.config.filter.http.authn.v2alpha1.FilterConfig&quot;,
                                        &quot;policy&quot;: {
                                            &quot;peers&quot;: &amp;#91;
                                                {
                                                    &quot;mtls&quot;: {
                                                        &quot;mode&quot;: &quot;PERMISSIVE&quot;
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.cors&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.cors.v2.Cors&quot;
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.fault&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.fault.v2.HTTPFault&quot;
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;istio.stats&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                                        &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&quot;,
                                        &quot;value&quot;: {
                                            &quot;config&quot;: {
                                                &quot;configuration&quot;: &quot;{\n  \&quot;debug\&quot;: \&quot;false\&quot;,\n  \&quot;stat_prefix\&quot;: \&quot;istio\&quot;\n}\n&quot;,
                                                &quot;root_id&quot;: &quot;stats_inbound&quot;,
                                                &quot;vm_config&quot;: {
                                                    &quot;code&quot;: {
                                                        &quot;local&quot;: {
                                                            &quot;inline_string&quot;: &quot;envoy.wasm.stats&quot;
                                                        }
                                                    },
                                                    &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;,
                                                    &quot;vm_id&quot;: &quot;stats_inbound&quot;
                                                }
                                            }
                                        }
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.router&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.router.v2.Router&quot;
                                    }
                                }
                            ],
                            &quot;tracing&quot;: {
                                &quot;clientSampling&quot;: {
                                    &quot;value&quot;: 100
                                },
                                &quot;randomSampling&quot;: {
                                    &quot;value&quot;: 100
                                },
                                &quot;overallSampling&quot;: {
                                    &quot;value&quot;: 100
                                }
                            },
                            &quot;serverName&quot;: &quot;istio-envoy&quot;,
                            &quot;streamIdleTimeout&quot;: &quot;0s&quot;,
                            &quot;accessLog&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;envoy.file_access_log&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog&quot;,
                                        &quot;path&quot;: &quot;/dev/stdout&quot;,
                                        &quot;format&quot;: &quot;&amp;#91;%START_TIME%] \&quot;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\&quot; %RESPONSE_CODE% %RESPONSE_FLAGS% \&quot;%DYNAMIC_METADATA(istio.mixer:status)%\&quot; \&quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%\&quot; %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \&quot;%REQ(X-FORWARDED-FOR)%\&quot; \&quot;%REQ(USER-AGENT)%\&quot; \&quot;%REQ(X-REQUEST-ID)%\&quot; \&quot;%REQ(:AUTHORITY)%\&quot; \&quot;%UPSTREAM_HOST%\&quot; %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\n&quot;
                                    }
                                }
                            ],
                            &quot;useRemoteAddress&quot;: false,
                            &quot;generateRequestId&quot;: true,
                            &quot;forwardClientCertDetails&quot;: &quot;APPEND_FORWARD&quot;,
                            &quot;setCurrentClientCertDetails&quot;: {
                                &quot;subject&quot;: true,
                                &quot;dns&quot;: true,
                                &quot;uri&quot;: true
                            },
                            &quot;upgradeConfigs&quot;: &amp;#91;
                                {
                                    &quot;upgradeType&quot;: &quot;websocket&quot;
                                }
                            ],
                            &quot;normalizePath&quot;: true
                        }
                    }
                ],
                &quot;name&quot;: &quot;10.244.2.155_9080&quot;
            }
        ],
        &quot;listenerFilters&quot;: &amp;#91;
            {
                &quot;name&quot;: &quot;envoy.listener.original_dst&quot;,
                &quot;typedConfig&quot;: {
                    &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.listener.original_dst.v2.OriginalDst&quot;
                }
            },
            {
                &quot;name&quot;: &quot;envoy.listener.tls_inspector&quot;,
                &quot;typedConfig&quot;: {
                    &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.listener.tls_inspector.v2.TlsInspector&quot;
                }
            },
            {
                &quot;name&quot;: &quot;envoy.listener.http_inspector&quot;,
                &quot;typedConfig&quot;: {
                    &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.listener.http_inspector.v2.HttpInspector&quot;
                }
            }
        ],
        &quot;listenerFiltersTimeout&quot;: &quot;1s&quot;,
        &quot;continueOnListenerFiltersTimeout&quot;: true,
        &quot;trafficDirection&quot;: &quot;INBOUND&quot;
    }
]
</code></pre><p>Check more istio practice detail at my tech blog <a href=https://imesh.club>https://imesh.club</a></p></div><div class=article-tags><a class="badge badge-light" href=/tags/istio/>istio</a>
<a class="badge badge-light" href=/tags/envoy/>envoy</a></div><div class="media author-card" itemscope itemtype=http://schema.org/Person><div class=media-body><h5 class=card-title itemprop=name><a href=http://linjing.io/>Jing Lin (林静)</a></h5><h6 class=card-subtitle>Senior Solution Architect@F5</h6><p class=card-text itemprop=description>Check my tech blog for more <a href=https://imesh.club>https://imesh.club</a></p><ul class=network-icon aria-hidden=true></ul></div></div><div class=article-widget><div class=hr-light></div><h3>Related</h3><ul><li><a href=/post/f5-istio-work-together/>F5 BIG-IP links Istio to enhance ingress service capabilities</a></li></ul></div><section id=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"linjingio"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><script src=https://cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin=anonymous></script><script src=https://cdn.bootcdn.net/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdn.bootcdn.net/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdn.bootcdn.net/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin=anonymous></script><script src=https://cdn.bootcdn.net/ajax/libs/highlight.js/9.15.6/highlight.min.js integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin=anonymous></script><script id=dsq-count-scr src=//linjingio.disqus.com/count.js async></script><script>hljs.initHighlightingOnLoad();</script><script>const search_index_filename="/index.json";const i18n={'placeholder':"Search...",'results':"results found",'no_results':"No results found"};const content_type={'post':"Posts",'project':"Projects",'publication':"Publications",'talk':"Talks"};</script><script id=search-hit-fuse-template type=text/x-template>
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script><script src=https://cdn.bootcdn.net/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script><script src=https://cdn.bootcdn.net/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script><script src=/js/academia.min.e4fc229c2f28284fc2dfa5b66a52b765.js></script><div class=container><footer class=site-footer><div class=container><div class=row><div class=col-md-6><p>Copyright © 2022 linjing.io host on github, imesh.cloud host on netlify. CI/CD by github actions and netlify.Thanks bootcdn support for front libary CDN &#183;
Powered by
<a href=https://themefisher.com target=_blank rel=noopener>themefisher</a> for
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a>.</p></div><div class=col-md-6><ul class="list-inline network-icon text-right"><li class=list-inline-item><a href=https://twitter.com/linjingchina target=_blank rel=noopener title="DM Me"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li class=list-inline-item><a href=https://github.com/myf5 target=_blank rel=noopener title=Github><i class="fab fa-github" aria-hidden=true></i></a></li><li class=list-inline-item><a href=https://www.linkedin.com/in/jing-lin-218b3915/ target=_blank rel=noopener title=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li class=list-inline-item><a href=https://imesh.club target=_blank rel=noopener title="My blog"><i class="fab fa-wordpress" aria-hidden=true></i></a></li></ul></div></div></div></footer></div><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i>Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i>Download</a><div id=modal-error></div></div></div></div></div></body></html>