<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Source Themes Academia 4.3.1"><meta name=generator content="Hugo 0.73.0"><meta name=author content="Jing Lin (林静)"><meta name=description content="CES is an open source project. Help users better manage the outgoing traffic of k8s. Solve the egress challenge in high dynamic IP scenarios,provides a wealth of outgoing control capability."><link rel=alternate hreflang=en-us href=http://linjing.io/post/f5-container-egress-service-ces/><meta name=theme-color content="#3f51b5"><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/academicons/1.8.6/css/academicons.min.css integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.6.0/css/all.css integrity=sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h crossorigin=anonymous><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/highlight.js/9.15.6/styles/github.min.css crossorigin=anonymous title=hl-light><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/highlight.js/9.15.6/styles/dracula.min.css crossorigin=anonymous title=hl-dark disabled><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lato:400,700|Open+Sans|Roboto+Mono&display=swap"><link rel=stylesheet href=/css/academia.min.bcef5eaccde0f18047d8dcec72cc428c.css><link rel=manifest href=/site.webmanifest><link rel=icon type=image/png href=/img/icon.png><link rel=apple-touch-icon type=image/png href=/img/icon-192.png><link rel=canonical href=http://linjing.io/post/f5-container-egress-service-ces/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@linjingchina"><meta property="twitter:creator" content="@linjingchina"><meta property="og:site_name" content="Jing Lin‘s profile"><meta property="og:url" content="http://linjing.io/post/f5-container-egress-service-ces/"><meta property="og:title" content="Project- Container Egress Service(CES) | Jing Lin‘s profile"><meta property="og:description" content="CES is an open source project. Help users better manage the outgoing traffic of k8s. Solve the egress challenge in high dynamic IP scenarios,provides a wealth of outgoing control capability."><meta property="og:image" content="http://linjing.io/post/f5-container-egress-service-ces/featured.jpeg"><meta property="twitter:image" content="http://linjing.io/post/f5-container-egress-service-ces/featured.jpeg"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2022-02-01T00:00:00+00:00"><meta property="article:modified_time" content="2024-12-28T09:46:37+08:00"><title>Project- Container Egress Service(CES) | Jing Lin‘s profile</title></head><body id=top data-spy=scroll data-target=#TableOfContents data-offset=71><aside class=search-results id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=#><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off role=textbox spellcheck=false type=search></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id=navbar-main><div class=container><a class=navbar-brand href=/>Jing Lin‘s profile</a>
<button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar aria-controls=navbar aria-expanded=false aria-label="Toggle navigation"><span><i class="fas fa-bars"></i></span></button><div class="collapse navbar-collapse" id=navbar><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/#about><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/#posts><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/#skills><span>Skills</span></a></li><li class=nav-item><a class=nav-link href=/#talks><span>Talks</span></a></li><li class=nav-item><a class=nav-link href=/#accomplishments><span>Accomplishments</span></a></li><li class=nav-item><a class=nav-link href=/#publications><span>Publications</span></a></li><li class=nav-item><a class=nav-link href=/#experience><span>Experience</span></a></li><li class=nav-item><a class="nav-link active" href=/><span>Courses</span></a></li><li class=nav-item><a class=nav-link href=/#slider><span>Customers</span></a></li><li class=nav-item><a class=nav-link href=/#contact><span>Contact</span></a></li><li class=nav-item><a class="nav-link js-search" href=#><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class="nav-link js-dark-toggle" href=#><i class="fas fa-moon" aria-hidden=true></i></a></li></ul></div></div></nav><article class="article py-5" itemscope itemtype=http://schema.org/Article><div class="container split-header"><div class="row justify-content-center"><div class=col-lg-8><img class="img-fluid w-100" src=/post/f5-container-egress-service-ces/featured_hu5c846b1d616a064e72f8375d5a9cc266_114353_680x500_fill_q90_lanczos_smart1.jpeg itemprop=image alt>
<span class=article-header-caption>My tech blog <a href=https://myf5.net>https://myf5.net</a></span></div><div class=col-lg-8><h1 itemprop=name>Project- Container Egress Service(CES)</h1><p class=page-subtitle>What is CES and why CES</p><meta content="2022-02-01 00:00:00 +0000 UTC" itemprop=datePublished><meta content="2024-12-28 09:46:37 +0800 +0800" itemprop=dateModified><div class=article-metadata><div><span itemprop="author name" itemtype=http://schema.org/Person>Jing Lin(林静)</span></div><span class=article-date>Last updated on
<time>Dec 28, 2024</time></span>
<span class=middot-divider></span><span class=article-reading-time>2 min read</span>
<span class=middot-divider></span><a href=/post/f5-container-egress-service-ces/#disqus_thread></a><div class=share-box aria-hidden=true><ul class=share><li><a href="https://twitter.com/intent/tweet?url=http://linjing.io/post/f5-container-egress-service-ces/&text=Project-%20Container%20Egress%20Service%28CES%29" target=_blank rel=noopener class=share-btn-twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=http://linjing.io/post/f5-container-egress-service-ces/&t=Project-%20Container%20Egress%20Service%28CES%29" target=_blank rel=noopener class=share-btn-facebook><i class="fab fa-facebook-f"></i></a></li><li><a href="mailto:?subject=Project-%20Container%20Egress%20Service%28CES%29&body=http://linjing.io/post/f5-container-egress-service-ces/" target=_blank rel=noopener class=share-btn-email><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=http://linjing.io/post/f5-container-egress-service-ces/&title=Project-%20Container%20Egress%20Service%28CES%29" target=_blank rel=noopener class=share-btn-linkedin><i class="fab fa-linkedin-in"></i></a></li><li><a href="https://web.whatsapp.com/send?text=Project-%20Container%20Egress%20Service%28CES%29%20http://linjing.io/post/f5-container-egress-service-ces/" target=_blank rel=noopener class=share-btn-whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=http://linjing.io/post/f5-container-egress-service-ces/&title=Project-%20Container%20Egress%20Service%28CES%29" target=_blank rel=noopener class=share-btn-weibo><i class="fab fa-weibo"></i></a></li></ul></div></div></div></div></div></div><div class=article-container><div class=article-style itemprop=articleBody><h2 id=solution-architecture>Solution architecture</h2><h3 id=components>Components</h3><p>The CES solution includes the following components:</p><ul><li>CES controller: a container running in k8s. This component is the control plane, responsible for converting the outbound policies that deployed in k8s into the external data plane component(here is F5 AFM).</li><li>F5 BIG-IP AFM: Data plane components running outside of k8s. Accept the configuration issued by the CES controller and execute specific access control rules, such as access control lists, bandwidth limiting, traffic programming, etc.</li><li>CNI: CNI is a choice of the user environment itself and is not included in the CES plan. However, different CNIs will have different effects on the functions of the CES solution. Use <a href=https://github.com/kubeovn/kube-ovn/>kube-ovn</a> CNI to get the full functionality of CES.</li></ul><h3 id=architecture-diagram>Architecture diagram</h3><p><img src=img/high-level-arch.jpg alt=high-level-arch></p><h3 id=policy-scope-and-role>Policy scope and role</h3><p>CES provides three policy scopes <code>cluster global</code> <code>namespace</code> and <code>service</code>. Its meaning and user role relationship are as follows:</p><table><thead><tr><th>scope</th><th>meaning</th><th>Adaptation role</th></tr></thead><tbody><tr><td>Cluster global</td><td>It is the global level policy of the cluster, which is used to control the general and overall access control of the cluster. For example, the cluster&rsquo;s access to basic public services such as NTP and DNS of the enterprise. The scope policy is applied to the outbound access control of all services in the cluster.</td><td>Cluster administrator, Security team</td></tr><tr><td>namespace</td><td>This policy level is effective for a single namespace or project. It is used to control the access of all services in specific NS or project to access the services out of the cluster. Policies in different namespaces or projects do not affect each other. *This function requires the support of CNI.</td><td>Project team, application operation team</td></tr><tr><td>service level</td><td>The policy control the k8s servcies to the external services. Only valid for specific services. So if the CNI can not support namespace level policy, set svc level policy is an alternative way.</td><td>Project team, application operation, microservice owner</td></tr></tbody></table><h3 id=tenant-isolation>Tenant isolation</h3><p>The CES solution supports strong isolation of <code>network + namespace</code>. Supports the administrative isolation of configuration objects on the data plane, and also supports strict traffic isolation at the network level. Support different namespaces to use overlapping CIDR.</p><pre><code>Need CNI support network isolation. For example kube-ovn's per ns subnet
</code></pre><h2 id=solution-value>Solution value</h2><h3 id=challenges-solved>Challenges solved</h3><ul><li>High-frequency changes in outbound traffic caused by container IP dynamics</li><li>Different role groups have different requirements for the scope setting of the policy, and the policy needs to match the role in multiple dimensions</li><li>Dynamic bandwidth limit requirements for outbound traffic</li><li>Protocol in-depth security inspection requirements</li><li>Advanced requirements for flow programmable based on access control events</li><li>Visualization requirements for outbound traffic</li></ul><h3 id=provided-capabilities>Provided capabilities</h3><ul><li>Dynamic IP ACL control with Cluster/Pod/NS granularity</li><li>Cluster/Pod/NS granular FQDN ACL control</li><li>Time-based access control</li><li>Matched flow event trigger and programmable</li><li>Matched traffic redirection</li><li>Protocol security and compliance testing</li><li>IP intelligence</li><li>Traffic matching log</li><li>Traffic matching visualization report</li><li>Protocol detection visual report</li><li>TCP/IP Errors report</li><li>NAT control and logging</li><li>Data flow visualization tracking</li><li>Visual simulation of access rules</li><li>Transparent detection mode</li><li>High-speed log outgoing</li></ul><pre><code>Partial functions will evolve along with version iterations
</code></pre><p><strong>Next step:</strong></p><p><a href=https://github.com/f5devcentral/container-egress-service/wiki/EN_2_CES_Installation>Understanding CES installation</a></p></div><div class=article-tags><a class="badge badge-light" href=/tags/f5/>F5</a>
<a class="badge badge-light" href=/tags/k8s/>k8s</a>
<a class="badge badge-light" href=/tags/ces/>ces</a>
<a class="badge badge-light" href=/tags/egress-traffic-controlling/>egress traffic controlling</a>
<a class="badge badge-light" href=/tags/afm/>afm</a></div><div class=article-widget><div class=hr-light></div><h3>Related</h3><ul><li><a href=/post/f5-cloudnative-media-interview-zhiding/>To implement cloud native, you need such an infrastructure</a></li><li><a href=/post/from-lb-to-cloud-native-application-services/>From load balancing to cloud native application services</a></li></ul></div><section id=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"linjingio"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><script src=https://cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin=anonymous></script><script src=https://cdn.bootcdn.net/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdn.bootcdn.net/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdn.bootcdn.net/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin=anonymous></script><script src=https://cdn.bootcdn.net/ajax/libs/highlight.js/9.15.6/highlight.min.js integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin=anonymous></script><script id=dsq-count-scr src=//linjingio.disqus.com/count.js async></script><script>hljs.initHighlightingOnLoad();</script><script>const search_index_filename="/index.json";const i18n={'placeholder':"Search...",'results':"results found",'no_results':"No results found"};const content_type={'post':"Posts",'project':"Projects",'publication':"Publications",'talk':"Talks"};</script><script id=search-hit-fuse-template type=text/x-template>
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script><script src=https://cdn.bootcdn.net/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script><script src=https://cdn.bootcdn.net/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script><script src=/js/academia.min.e4fc229c2f28284fc2dfa5b66a52b765.js></script><div class=container><footer class=site-footer><div class=container><div class=row><div class=col-md-6><p>Copyright © 2024 linjing.io host on github, imesh.cloud host on netlify. CI/CD by github actions and netlify.Thanks bootcdn support for front libary CDN &#183;
Powered by
<a href=https://themefisher.com target=_blank rel=noopener>themefisher</a> for
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a>.</p></div><div class=col-md-6><ul class="list-inline network-icon text-right"><li class=list-inline-item><a href=https://twitter.com/linjingchina target=_blank rel=noopener title="DM Me"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li class=list-inline-item><a href=https://github.com/myf5 target=_blank rel=noopener title=Github><i class="fab fa-github" aria-hidden=true></i></a></li><li class=list-inline-item><a href=https://www.linkedin.com/in/jing-lin-218b3915/ target=_blank rel=noopener title=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li class=list-inline-item><a href=https://imesh.club target=_blank rel=noopener title="My blog"><i class="fab fa-wordpress" aria-hidden=true></i></a></li></ul></div></div></div></footer></div><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i>Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i>Download</a><div id=modal-error></div></div></div></div></div></body></html>